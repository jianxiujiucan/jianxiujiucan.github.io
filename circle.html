<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Circle</title>
  <style>
    .progress {
      width: 200px;
      height: 200px;
      border: solid 1px #666;
    }
  </style>
</head>

<body>
  <div class="progress"></div>
  <script>
    class Circle {
      constructor(params) {
        this.element = document.querySelector(params.element)
        this.type = params.type || 'circle'
        this.strokeWidth = params.strokeWidth || 10
        this.value = params.value || 0
        this.color = params.color || '#69f'
        this.trackColor = params.trackColor || '#eee'
        this.linecap = params.linecap || 'square'
        this.render()
      }

      render() {
        const size = this.element.clientWidth   // 获取元素的宽度
        const radius = size / 2 - this.strokeWidth / 2  // 半径
        const circleDistance = radius + this.strokeWidth / 2 // 距离圆心的距离
        const perimeter = 2 * Math.PI * radius // 周长，用来算进度条的长度
        const scale = this.type === 'circle' ? 1 : 0.75 // 比例
        const rotate = this.type === 'circle' ? '-90deg' : '-225deg' // 旋转角度
        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')

        let stroke = '', gradients = ''
        this.element.appendChild(svg)
        svg.setAttribute('viewBox', `0 0 ${size} ${size}`)
        if (typeof this.color === 'string') {
          stroke = this.color
        } else {
          gradients = this.renderGradients(this.color)
          stroke = `url(#gradient)`
        }

        const track = `<circle 
          r=${radius}
          cx=${size / 2} 
          cy=${size / 2} 
          stroke-width=${this.strokeWidth} 
          fill='none' 
          stroke=${this.trackColor} 
          style='transform: rotate(${rotate}); stroke-dasharray: ${perimeter * scale}px, ${perimeter}px; transform-origin: ${circleDistance}px ${circleDistance}px; stroke-linecap: ${this.linecap}'></circle>` // 轨道

        const path = `<circle 
          r=${radius} 
          cx=${size / 2} 
          cy=${size / 2} 
          stroke-width=${this.strokeWidth} 
          fill='none' 
          stroke='${stroke}'
          style='transform: rotate(${rotate}); stroke-dasharray: ${perimeter * scale / 100 * this.value}px, ${perimeter}px; transform-origin: ${circleDistance}px ${circleDistance}px; stroke-linecap: ${this.linecap}'></circle>`  // 进度条

        svg.innerHTML = gradients + track + path

      }
      renderGradients(color) {
        const [startColor, endColor] = color
        let str = ''
        for (let i = 0; i < color.length; i++) {
          str += `<stop 
                offset="${(100 / color.length) * i}%" 
                stop-color="${color[i]}">
              </stop>`
        }
        const gradients = `<defs>
            <linearGradient 
              id="gradient" 
              x1="100%" 
              y1="0%" 
              x2="0%" 
              y2="0%">
              ${str}
            </linearGradient>
          </defs>`
        return gradients
      }
    }

    let circle = new Circle({
      element: '.progress',
      value: 100,
      strokeWidth: 10,
      color: ['#bb6dff', '#00b7ee', 'rgb(82, 196, 26)'],
      trackColor: '#eee',
      type: 'dashboard',
      linecap: 'round',
      //linearColor: ['#bb6dff', '#00b7ee']
    })
  </script>
</body>

</html>