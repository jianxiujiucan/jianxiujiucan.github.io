<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>仿 windows 10 日历</title>
  <link rel="stylesheet" href="css/calendar.css">
  <style>



  </style>
</head>

<body>
  <div class="wrapper">
    <div class="time">
      <p id="timeText" class="time__text">00:00:00</p>
      <p id="timeDate" class="time__date"></p>
    </div>
    <div class="calendar">
      <div class="header">
        <p id="changeDate" class="change-date"></p>
        <div class="button">
          <button id="lastMonth"><i class="arrow arrow--up"></i></button>
          <button id="nextMonth"><i class="arrow arrow--down"></i></button>
        </div>
      </div>
      <div id="dayList" class="date-wrapper">
        <div class="week-list">
          <span>日</span>
          <span>一</span>
          <span>二</span>
          <span>三</span>
          <span>四</span>
          <span>五</span>
          <span>六</span>
        </div>
        <div class="date-list" id="dateList"></div>
      </div>
      <div id="monthList" class="month-list"></div>
    </div>
  </div>
  <script>
    let $dateList = document.getElementById('dateList')
    let $buttonLast = document.getElementById('lastMonth')
    let $buttonNext = document.getElementById('nextMonth')
    let $timeText = document.getElementById('timeText')
    let $timeDate = document.getElementById('timeDate')
    let $changeDate = document.getElementById('changeDate')
    let $monthList = document.getElementById('monthList')
    let $dayList = document.getElementById('dayList')
    let date = new Date()
    let currentYear = date.getFullYear() //当前年份
    let currentMonth = date.getMonth() // 当前月份
    let currentDay = date.getDate() //当前几号

    $timeDate.innerHTML = `${currentYear}年${currentMonth + 1}月${currentDay}日`
    renderDays(currentYear, currentMonth)
    renderMonths()
    // 顶部时分秒
    setInterval(() => {
      let date = new Date()
      let hour = date.getHours().toString().padStart(2, '0')
      let minute = date.getMinutes().toString().padStart(2, '0')
      let second = date.getSeconds().toString().padStart(2, '0')
      $timeText.innerHTML = `${hour}:${minute}:${second}`
    }, 1000)


    // 判断是否是闰年
    function isLeapYear(year) {
      if (year % 4 === 0 && year % 100 != 0 || year % 400 === 0) {
        return 29
      } else {
        return 28
      }
    }


    // 日历日期列表
    function renderDays(year, month) {
      $changeDate.innerHTML = `${year}年${parseInt(month) + 1}月`
      let contentList = ``
      let days = [31, isLeapYear(year), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31] // 当年月份的天数数组
      let firstDay = new Date(year, month, 1) //当前月份第一天信息
      let items = 0 // 元素计数

      // 上个月日期生成
      for (let i = firstDay.getDay() - 1; i >= 0; i--) {
        let over = month === 0 ? 31 : days[month - 1]
        contentList += `<div class="item disabled-month"><span>${over - i}</span></div>`
        items++
      }
      // 当前月份日期生成
      for (let i = 1; i <= days[month]; i++) {
        if (i === currentDay && month === date.getMonth() && year === date.getFullYear()) { //当天选中态
          contentList += `<div class="item current"><span>${i}</span></div>`
        } else {
          contentList += `<div class="item"><span>${i}</span></div>`
        }
        items++
      }

      // 下个月日期生成
      let lastDay = new Date(year, month, days[month])

      for (let i = 1; i < 7 - lastDay.getDay(); i++) {
        contentList += `<div class="item disabled-month"><span>${i}</span></div>`
        items++
      }

      // 如果当前月份不足6行，则填充1行，保证每次生成6行。
      if (items < 42) {
        for (let i = 1; i <= 7; i++) {
          contentList += `<div class="item disabled-month"><span>${i}</span></div>`
        }
      }
      $dateList.innerHTML = contentList //将生成的dom结构填充到页面里

      // let itemList = document.querySelectorAll('.item')
      // for (let item of itemList) {
      //   item.addEventListener('click', function () {
      //     for (let i = 0; i < itemList.length; i++) {
      //       itemList[i].classList.remove('is-active')
      //     }
      //     this.classList.add('is-active')
      //   });
      // }

     $dateList.addEventListener('click',function(e){
      if(document.querySelector('.is-active') != null){
        document.querySelector('.is-active').classList.remove('is-active')
      } 
      e.target.parentNode.classList.add('is-active')
    })
    }



    // 切换到月份
    $changeDate.addEventListener('click', function () {
      $dayList.style.display = 'none'
      $monthList.style.display = 'grid'
    })

    //生成月份
    
    function renderMonths() {
      let monthDom = ''
      for (let i = 1; i <= 12; i++) {
        if (i === currentMonth + 1) {
          monthDom += `<div class="month-item is-current" data-year=${currentYear} data-month=${i}>${i}月</div>`
        } else {
          monthDom += `<div class="month-item" data-year=${currentYear} data-month=${i}>${i}月</div>`
        }
      }
      for (let i = 1; i <= 4; i++) {
        monthDom += `<div class="month-item is-disabled" data-year=${currentYear
          + 1} data-month=${i}>${i}月</div>`
      }
      $monthList.innerHTML = monthDom
    }



    document.addEventListener('DOMContentLoaded', () => {
      $buttonLast.addEventListener('click', () => {
        currentMonth--
        if (currentMonth < 0) {
          currentYear -= 1
          currentMonth = 11
        }
        renderDays(currentYear, currentMonth)
      })

      $buttonNext.addEventListener('click', () => {
        currentMonth++
        if (currentMonth > 11) {
          currentYear += 1
          currentMonth = 0
        }
        renderDays(currentYear, currentMonth)
      })

      

      let itemsMonth = document.querySelectorAll('.month-item')
      for (let itemMonth of itemsMonth) {
        itemMonth.addEventListener('click', function () {
          for (let i = 0; i < itemsMonth.length; i++) {
            renderDays(this.dataset.year, this.dataset.month - 1)
            $dayList.style.display = 'block'
            $monthList.style.display = 'none'
          }
        });
      }
    });
  </script>
</body>

</html>